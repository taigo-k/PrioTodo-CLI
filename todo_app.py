# -*- coding: utf-8 -*-
"""todo_app.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1m7ZfOVYiYinnTZvUJ9YEfbRCATOuk5E_
"""

import json # ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜ã€èª­ã¿è¾¼ã¿
import os # ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª

todo_list = []
FILE_NAME = "todo_data.json" # ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«
priority_map = {"é«˜": 1, "ä¸­": 2, "ä½": 3}

# ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–æ©Ÿèƒ½
# ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹
def save_tasks():

  try:
    with open(FILE_NAME, 'w', encoding='utf-8') as f: # æ›¸ãè¾¼ã¿
      json.dump(todo_list, f, ensure_ascii=False, indent=4) # ä¿å­˜å‡¦ç†
    print(f"\nâœ… ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆã‚’ {FILE_NAME} ã«ä¿å­˜ã—ã¾ã—ãŸã€‚")
  except Exception as e:
    print(f"âš ï¸ ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}")

# ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆã‚’èª­ã¿è¾¼ã¿ã€todo_listã«æ ¼ç´
def load_tasks():

  global todo_list # ç·¨é›†æº–å‚™

  if os.path.exists(FILE_NAME): # ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ç¢ºèª
    try:
      with open(FILE_NAME, 'r', encoding='utf-8') as f: # èª­ã¿è¾¼ã¿
        data = json.load(f)
        if isinstance(data, list): # å½¢å¼ç¢ºèª(ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ, ãƒ‡ãƒ¼ã‚¿å‹)
          for item in data:
            if isinstance(item, str):
              todo_list.append({"name": item, "priority": "ä¸­"})
            elif isinstance(item, dict) and "name" in item:
              todo_list.append(item)
          print(f"ğŸ“‚ {FILE_NAME} ã‹ã‚‰ã‚¿ã‚¹ã‚¯ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸã€‚")
        else:
          print(f"âš ï¸ ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ãŒãƒªã‚¹ãƒˆå½¢å¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æ–°ã—ã„ãƒªã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™ã€‚")
    except Exception as e:
      print(f"âš ï¸ ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}")
  else:
    print("To-Doãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚æ–°ã—ã„ãƒªã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™ã€‚")

# ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ 
def add_task(task_name, priority):

  new_task = {"name": task_name, "priority": priority}
  todo_list.append(new_task)
  print(f"\nâœ… ã‚¿ã‚¹ã‚¯ã€Œ{task_name}ã€(å„ªå…ˆåº¦: {priority})ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚")

# ã‚¿ã‚¹ã‚¯ä¸€è¦§è¡¨ç¤º
def view_tasks():

  if not todo_list:
    print("ãƒªã‚¹ãƒˆã¯ç©ºã§ã™ã€‚ã‚¿ã‚¹ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚")
    return []

  # ã‚½ãƒ¼ãƒˆå‡¦ç†ã®ãŸã‚ã®ã‚­ãƒ¼é–¢æ•°
  def get_priority_value(task):
      priority_str = task.get("priority", "ä¸­") # å€¤ã‚’å–å¾—ã€ãªã‘ã‚Œã°ã€Œä¸­ã€ã«è¨­å®š
      return priority_map.get(priority_str, 99)

  # ä¸¦ã¹æ›¿ãˆå‡¦ç†ã®å®Ÿè¡Œ
  sorted_tasks = sorted(todo_list, key=get_priority_value)
  print("\n--- ç¾åœ¨ã® To-Do ãƒªã‚¹ãƒˆ (å„ªå…ˆåº¦é †) ---")

  # ä¸¦ã¹æ›¿ãˆãŸãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
  for index, task in enumerate(sorted_tasks):
    task_name = task["name"]
    task_priority = task["priority"]

    print(f"{index + 1}. [{task_priority}] {task_name}")
  print("---------------------------------------\n")

  # ä¸¦ã¹æ›¿ãˆãŸãƒªã‚¹ãƒˆã‚’å‘¼ã³å‡ºã—å…ƒã«è¿”ã™
  return sorted_tasks

# ã‚¿ã‚¹ã‚¯ã‚’å®Œäº†(å‰Šé™¤)ã™ã‚‹
def complete_task(task_number_str, sorted_list):

  try:
    task_number = int(task_number_str)
    task_to_delete = sorted_list[task_number - 1] # ã‚¿ã‚¹ã‚¯ç•ªå·ã«å¯¾å¿œ
    completed_task_name = task_to_delete["name"]
    todo_list.remove(task_to_delete) # å‰Šé™¤
    print(f"\nâœ… ã‚¿ã‚¹ã‚¯ã€Œ{completed_task_name}ã€ã‚’å®Œäº†ã—ã€ãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤ã—ã¾ã—ãŸã€‚")

  except IndexError:
    print("âš ï¸ ã‚¨ãƒ©ãƒ¼: ãã®ç•ªå·ã®ã‚¿ã‚¹ã‚¯ã¯å­˜åœ¨ã—ã¾ã›ã‚“ã€‚")
  except ValueError:
    print("âš ï¸ ã‚¨ãƒ©ãƒ¼: ã‚¿ã‚¹ã‚¯ç•ªå·ã¯æ•´æ•°ã§æŒ‡å®šã—ã¦ãã ã•ã„ã€‚")
  except Exception as e:
    print(f"âš ï¸ äºˆæœŸã›ã¬ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}")

# ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼
def main_menu():

  load_tasks()

  while True: # ç„¡é™ãƒ«ãƒ¼ãƒ—
    print("\n==================================")
    print("    To-Do ãƒªã‚¹ãƒˆç®¡ç†ãƒ„ãƒ¼ãƒ« (CLI)")
    print("==================================")
    print("1. ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ ")
    print("2. ã‚¿ã‚¹ã‚¯ä¸€è¦§ã‚’è¡¨ç¤º")
    print("3. ã‚¿ã‚¹ã‚¯ã‚’å®Œäº†ï¼ˆå‰Šé™¤ï¼‰")
    print("4. çµ‚äº†")

    choice = input("æ“ä½œã‚’é¸æŠã—ã¦ãã ã•ã„ (1-4): ") # æ–‡å­—åˆ—ã‚’å–å¾—

    if choice == '1':
      task_name = input("è¿½åŠ ã™ã‚‹ã‚¿ã‚¹ã‚¯åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„: ")
      if task_name:
        priority_options = {"1": "é«˜", "2": "ä¸­", "3": "ä½"}
        print("å„ªå…ˆåº¦ã‚’é¸æŠã—ã¦ãã ã•ã„:")
        print("1: é«˜")
        print("2: ä¸­")
        print("3: ä½")
        priority_choice = input("å„ªå…ˆåº¦ (1, 2, 3) ã‚’å…¥åŠ›: ").strip()
        priority = priority_options.get(priority_choice, "ä¸­") # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã€Œä¸­ã€
        add_task(task_name, priority)

    elif choice == '2':
      view_tasks()

    elif choice == '3':
      sorted_list = view_tasks()
      if sorted_list:
        task_num_str = input("å®Œäº†ã™ã‚‹ã‚¿ã‚¹ã‚¯ã®ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„: ").strip()
        complete_task(task_num_str, sorted_list)

    elif choice == '4':
      save_tasks()
      print("\nğŸ‘‹ ãƒ„ãƒ¼ãƒ«ã‚’çµ‚äº†ã—ã¾ã™ã€‚ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼")
      break

    else:
      print("\nâš ï¸ ç„¡åŠ¹ãªé¸æŠã§ã™ã€‚1ã‹ã‚‰4ã®æ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚")

# ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
if __name__ == "__main__":
  main_menu()

